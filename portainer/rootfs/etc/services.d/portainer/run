#!/usr/bin/with-contenv bashio
# ==============================================================================
# Community Hass.io Add-ons: Portainer
# Runs portainer
# ==============================================================================
declare -a options

bashio::log.info 'Starting Portainer...'

options+=(--data /data)
options+=(--bind 127.0.0.1:9000)
options+=(--no-auth)
options+=(--template-file /opt/portainer/templates.json)
options+=(--no-analytics)
options+=(--host unix:///var/run/docker.sock)


# Hide Hassio containers by default
if bashio::config.true 'hide_hassio_containers'; then
    # shellcheck disable=SC2191
    options+=(--hide-label io.hass.type=supervisor)
    # shellcheck disable=SC2191
    options+=(--hide-label io.hass.type=homeassistant)
    # shellcheck disable=SC2191
    options+=(--hide-label io.hass.type=addon)

fi

# Run Portainer
exec /opt/portainer/portainer "${options[@]}"
